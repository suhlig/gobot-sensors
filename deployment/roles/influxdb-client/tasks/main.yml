- name: Download tarball
  get_url:
    url: "https://dl.influxdata.com/influxdb/releases/influxdb-{{ influxdb_version }}_linux_armhf.tar.gz"
    dest: "/tmp/influxdb-{{ influxdb_version }}_linux_armhf.tar.gz"
  tags: influxdb

- name: Create temporary directory for unpacking into a known location
  tempfile:
    state: directory
    suffix: influxdb
  register: temporary_directory
  tags: influxdb

- name: Unpack tarball
  unarchive:
    src: "/tmp/influxdb-{{ influxdb_version }}_linux_armhf.tar.gz"
    dest: "{{ temporary_directory.path }}"
    extra_opts: "--strip-components=2"
    remote_src: true
  tags: influxdb

- name: Put the binary in place
  copy:
    src: "{{ temporary_directory.path }}/usr/bin/influx"
    dest: "/usr/local/bin/"
    remote_src: true
    mode: "0755"
  become: true
  tags: influxdb

- name: Remove temporary directory
  file:
    path: "{{ temporary_directory.path }}"
    state: absent
  tags: influxdb
